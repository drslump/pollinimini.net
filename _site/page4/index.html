<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title>Pollinimini.net</title>
     
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="generator" content="Jekyll" />
    <meta name="author" content="Iván -DrSlump- Montes" />
    <meta name="description" content="DrSlump @ Pollinimini.net" />

    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="/atom.xml" />
     
    
    <link rel="stylesheet" href="/resources/global.css" type="text/css" />
    
     
    
  </head>
  <body>
    <!--[if lt IE 8]>
    <div style='border: 1px solid #F7941D; background: #FEEFDA; text-align: center; clear: both; height: 75px; position: relative;'>
    <div style='position: absolute; right: 3px; top: 3px; font-family: courier new; font-weight: bold;'><a href='#' onclick='javascript:this.parentNode.parentNode.style.display="none"; return false;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-cornerx.jpg' style='border: none;' alt='Close this notice'/></a></div>
    <div style='width: 640px; margin: 0 auto; text-align: left; padding: 0; overflow: hidden; color: black;'>
      <div style='width: 75px; float: left;'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-warning.jpg' alt='Warning!'/></div>
      <div style='width: 275px; float: left; font-family: Arial, sans-serif;'>
        <div style='font-size: 14px; font-weight: bold; margin-top: 12px;'>You are using an outdated browser</div>
        <div style='font-size: 12px; margin-top: 6px; line-height: 12px;'>For a better experience using this site, please upgrade to a modern web browser.</div>
      </div>
      <div style='width: 75px; float: left;'><a href='http://www.firefox.com' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-firefox.jpg' style='border: none;' alt='Get Firefox 3.5'/></a></div>
      <div style='width: 75px; float: left;'><a href='http://www.browserforthebetter.com/download.html' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-ie8.jpg' style='border: none;' alt='Get Internet Explorer 8'/></a></div>
      <div style='width: 73px; float: left;'><a href='http://www.apple.com/safari/download/' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-safari.jpg' style='border: none;' alt='Get Safari 4'/></a></div>
      <div style='float: left;'><a href='http://www.google.com/chrome' target='_blank'><img src='http://www.ie6nomore.com/files/theme/ie6nomore-chrome.jpg' style='border: none;' alt='Get Google Chrome'/></a></div>
    </div>
    </div>
    <![endif]-->

    <div id="header">
      <h1>
        <a href="/">Pollinimini.net</a>        
      </h1>
    </div>

    <ul id="navigation">
    
      <li>
        <a  href="/" >Blog</a>
        
      </li>
    
      <li>
        <a  href="/about/" >About</a>
        
          <ul>
          
            <li>
              <a  href="/portfolio/" >Portfolio</a>
            </li>
          
            <li>
              <a  href="mailto:drslump-at-pollinimini-dot-net" >Contact</a>
            </li>
          
          </ul>
        
      </li>
    
    </ul>
      
    <div id="body">
      <a name="content" class="hidden">Skip to content</a>
      <div id="sidebar">
        
            <p class="about">
    <a href="/about">
        <img src="/resources/meatduck.png" width="80" height="80" alt="Avatar" />
    </a>
    Hi, I'm Iván Montes, also known as DrSlump, a passionate web developer.
    You can follow me on <a href="/atom.xml">this blog</a>, fork me on 
    <a href="http://github.com/drslump">GitHub</a> and check out some of my
    work on my <a href="/portfolio">portfolio</a>.
</p>

<a class="twitter-timeline" data-dnt="true" href="https://twitter.com/DrSlump" data-widget-id="399685000380952576">Tweets by @DrSlump</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

        
      </div>

      <div id="content">
        
  <div class="entry">
  <h2>
    
    <a href="/blog/my-new-programming-font-inconsolata">My new programming font: Inconsolata</a>
    
  </h2>
   
  <div class="entry-meta">
    Mar 16, 2009
    — Filled in Technology
    
      and tagged as
      font, ide, and programming
    

    <a class="entry-comments" href="/blog/my-new-programming-font-inconsolata/#disqus_thread"></a>
  </div>
   
  <div class="entry-content">
    
        <p>Just a short post to announce a jewel I&#8217;ve just found. The <a href='http://www.levien.com/type/myfonts/inconsolata.html'>Inconsolata font</a> is a great monospace font suitable to use in text terminals and code editors or IDEs.</p>

<p>It&#8217;s replacing now the ancient Mac&#8217;s Monaco which has served damn well over the years but I feel like I needed a change and Inconsolata feels bolder and more vibrant than Monaco or Microsoft&#8217;s Consolas.</p>

<p>Update: This font was initially conceived for printing so it doesn&#8217;t perform well at small sizes, so to get it at its full glory I recommed a size of at least 12 points over a dark background.</p>
    
  </div>
   
  <div class="entry-footer">
  </div>
</div>
 

  <div class="entry">
  <h2>
    
    <a href="/blog/solution-php-namespace-separator-moaning">A solution to PHP's new namespace separator moaning</a>
    
  </h2>
   
  <div class="entry-meta">
    Nov 09, 2008
    — Filled in Code
    
      and tagged as
      irony, namaspace, php, and webdev
    

    <a class="entry-comments" href="/blog/solution-php-namespace-separator-moaning/#disqus_thread"></a>
  </div>
   
  <div class="entry-content">
    
        <p>I&#8217;ve been quite busy lately but I&#8217;ve obviously been exposed to all the fud about the PHP internals decission of choosing the back-slash as the namespace separator.</p>

<p>So to keep everyone happy I&#8217;ve spent a few minutes working on a solution to the problem and here it goes:</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>
<span class='k'>class</span> <span class='nc'>NsFixerFileStream</span> <span class='p'>{</span>
    <span class='k'>protected</span> <span class='nv'>$fp</span><span class='p'>;</span>
    <span class='k'>protected</span> <span class='nv'>$separator</span> <span class='o'>=</span> <span class='s1'>&#39;:::&#39;</span><span class='p'>;</span>
    <span class='k'>protected</span> <span class='nv'>$isPHP</span> <span class='o'>=</span> <span class='k'>false</span><span class='p'>;</span>
    <span class='k'>public</span> <span class='nv'>$context</span><span class='p'>;</span>

    <span class='k'>function</span> <span class='nf'>stream_open</span><span class='p'>(</span><span class='nv'>$path</span><span class='p'>,</span> <span class='nv'>$mode</span><span class='p'>,</span> <span class='nv'>$options</span><span class='p'>,</span> <span class='o'>&amp;</span><span class='nv'>$opened_path</span><span class='p'>)</span>
    <span class='p'>{</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>context</span><span class='p'>)</span> <span class='p'>{</span>
                <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>context</span> <span class='o'>=</span> <span class='nb'>stream_context_get_default</span><span class='p'>();</span>
        <span class='p'>}</span>
        <span class='nv'>$opts</span> <span class='o'>=</span> <span class='nb'>stream_context_get_options</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>context</span><span class='p'>);</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='k'>empty</span><span class='p'>(</span><span class='nv'>$opts</span><span class='p'>[</span><span class='s1'>&#39;file&#39;</span><span class='p'>])</span> <span class='o'>&amp;&amp;</span> <span class='o'>!</span><span class='k'>empty</span><span class='p'>(</span><span class='nv'>$opts</span><span class='p'>[</span><span class='s1'>&#39;file&#39;</span><span class='p'>][</span><span class='s1'>&#39;separator&#39;</span><span class='p'>]))</span> <span class='p'>{</span>
                <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>separator</span> <span class='o'>=</span> <span class='nv'>$opts</span><span class='p'>[</span><span class='s1'>&#39;file&#39;</span><span class='p'>][</span><span class='s1'>&#39;separator&#39;</span><span class='p'>];</span>
        <span class='p'>}</span>

        <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>isPHP</span> <span class='o'>=</span> <span class='nb'>pathinfo</span><span class='p'>(</span><span class='nv'>$path</span><span class='p'>,</span> <span class='nx'>PATHINFO_EXTENSION</span><span class='p'>)</span> <span class='o'>===</span> <span class='s1'>&#39;php&#39;</span><span class='p'>;</span>

        <span class='nx'>stream_wrapper_restore</span><span class='p'>(</span><span class='s1'>&#39;file&#39;</span><span class='p'>);</span>

        <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>fp</span> <span class='o'>=</span> <span class='nb'>fopen</span><span class='p'>(</span><span class='nv'>$path</span><span class='p'>,</span> <span class='nv'>$mode</span><span class='p'>);</span>

        <span class='nx'>stream_wrapper_unregister</span><span class='p'>(</span><span class='s1'>&#39;file&#39;</span><span class='p'>);</span>
        <span class='nx'>stream_wrapper_register</span><span class='p'>(</span><span class='s1'>&#39;file&#39;</span><span class='p'>,</span> <span class='nb'>get_class</span><span class='p'>(</span><span class='nv'>$this</span><span class='p'>));</span>

        <span class='k'>return</span> <span class='o'>!</span><span class='k'>empty</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>fp</span><span class='p'>);</span>
    <span class='p'>}</span>

    <span class='k'>function</span> <span class='nf'>stream_read</span><span class='p'>(</span><span class='nv'>$count</span><span class='p'>)</span>
    <span class='p'>{</span>
        <span class='nv'>$data</span> <span class='o'>=</span> <span class='nb'>fread</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>fp</span><span class='p'>,</span> <span class='nv'>$count</span><span class='p'>);</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>isPHP</span> <span class='o'>&amp;&amp;</span> <span class='o'>!</span><span class='k'>empty</span><span class='p'>(</span><span class='nv'>$data</span><span class='p'>))</span> <span class='p'>{</span>
                <span class='nv'>$data</span> <span class='o'>=</span> <span class='nb'>str_replace</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>separator</span><span class='p'>,</span> <span class='s1'>&#39;\\&#39;</span><span class='p'>,</span> <span class='nv'>$data</span><span class='p'>);</span>
        <span class='p'>}</span>

        <span class='k'>return</span> <span class='nv'>$data</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='k'>function</span> <span class='nf'>stream_write</span><span class='p'>(</span><span class='nv'>$data</span><span class='p'>)</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='nb'>fwrite</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>fp</span><span class='p'>,</span> <span class='nv'>$data</span><span class='p'>);</span>
    <span class='p'>}</span>

    <span class='k'>function</span> <span class='nf'>stream_tell</span><span class='p'>()</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='nb'>ftell</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>fp</span><span class='p'>);</span>
    <span class='p'>}</span>

    <span class='k'>function</span> <span class='nf'>stream_eof</span><span class='p'>()</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='nb'>feof</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>fp</span><span class='p'>);</span>
    <span class='p'>}</span>

    <span class='k'>function</span> <span class='nf'>stream_seek</span><span class='p'>(</span><span class='nv'>$offset</span><span class='p'>,</span> <span class='nv'>$whence</span><span class='p'>)</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='nb'>fseek</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>fp</span><span class='p'>,</span> <span class='nv'>$offset</span><span class='p'>,</span> <span class='nv'>$whence</span><span class='p'>);</span>
    <span class='p'>}</span>

    <span class='k'>function</span> <span class='nf'>stream_stat</span><span class='p'>()</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='nb'>fstat</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>fp</span><span class='p'>);</span>
    <span class='p'>}</span>
<span class='p'>}</span>


<span class='c1'>// Replace default stream wrapper with out custom one</span>
<span class='nx'>stream_wrapper_unregister</span><span class='p'>(</span><span class='s1'>&#39;file&#39;</span><span class='p'>);</span>
<span class='nx'>stream_wrapper_register</span><span class='p'>(</span><span class='s2'>&quot;file&quot;</span><span class='p'>,</span> <span class='s2'>&quot;NsFixerFileStream&quot;</span><span class='p'>)</span>
    <span class='k'>or</span> <span class='k'>die</span><span class='p'>(</span><span class='s2'>&quot;Failed to register protocol&quot;</span><span class='p'>);</span>

<span class='c1'>// Define the default namespace separator</span>
<span class='nb'>stream_context_set_default</span><span class='p'>(</span><span class='k'>array</span><span class='p'>(</span>
        <span class='s1'>&#39;file&#39;</span> <span class='o'>=&gt;</span> <span class='k'>array</span><span class='p'>(</span>
                <span class='s1'>&#39;separator&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;:::&#39;</span>
        <span class='p'>)</span>
<span class='p'>));</span>
</code></pre></div>
<p>For the least versed on PHP&#8217;s stream wrappers, what it does is replace the standard file i/o stream with one that replaces on the fly everything you like to be a namespace separator with an ugly back-slash. Just place this on a file on your server and add its location to your <code>auto_prepend_file</code> ini directive.</p>

<p>Now you can spend your time writing stuff like the following instead of blogging about how the ugly back-slash in your code can ruin your way of life :)</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>
<span class='k'>namespace</span> <span class='nx'>DRSLUMP</span><span class='o'>:::</span><span class='nx'>test</span><span class='p'>;</span>

<span class='k'>class</span> <span class='nc'>foo</span> <span class='p'>{</span>
    <span class='k'>static</span> <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>bar</span><span class='p'>(){</span>
        <span class='o'>:::</span><span class='nb'>printf</span><span class='p'>(</span><span class='s1'>&#39;Hello %s!&#39;</span><span class='p'>,</span> <span class='s1'>&#39;world&#39;</span><span class='p'>);</span>
    <span class='p'>}</span>
<span class='p'>}</span>

<span class='o'>:::</span><span class='nx'>DRSLUMP</span><span class='o'>:::</span><span class='nx'>test</span><span class='o'>:::</span><span class='nx'>foo</span><span class='o'>::</span><span class='na'>bar</span><span class='p'>();</span>
</code></pre></div>
    
  </div>
   
  <div class="entry-footer">
  </div>
</div>
 

  <div class="entry">
  <h2>
    
    <a href="/blog/tags-emulation-zend-cache">Tags emulation for Zend_Cache</a>
    
  </h2>
   
  <div class="entry-meta">
    Aug 06, 2008
    — Filled in Code
    
      and tagged as
      zf, cache, webdev, php, zend, and memcached
    

    <a class="entry-comments" href="/blog/tags-emulation-zend-cache/#disqus_thread"></a>
  </div>
   
  <div class="entry-content">
    
        <p>Managing a cache is a complex task, at first you start placing random stuff on it, when you need to squeeze a few more hits per second you keep adding stuff to the cache. At the end of the day, if you&#8217;ve not planned it carefully, you might end up with a nightmare of stale data in your pages or even a completely broken site.</p>

<p>One easy way to apply some logic to the cached data and help in the invalidation of cached stuff is the use of tags. Cache tags are a simple way to group cached items so it gets easy to remove/invalidate them if needed. For example, if we have an online shop and we are caching paginated list of items by their category, then we might have keys like <code>list-{category}-{startOffset}</code>, if we add a new item to our shop we have to invalidate all the cached partial lists (since it could be at any position in the list). If we apply a simple tag, like <code>list-{category}</code> to the cached lists we can group them and proceed to their invalidation when a new product is added or moved to a given category, so our online data is always fresh.</p>

<p>The <a href='http://framework.zend.com/'>Zend Framework</a> implements tag support in its cache component, but unfortunately not APC neither the high performance Memcached do support grouping or tags. For the later one there is a fork/patch, <a href='http://code.google.com/p/memcached-tag'>memcached-tag</a>, however it does not seem to be very mature yet as to use in production.</p>

<p>Still not everything is lost, we can emulate tag support by keeping ourselves a relation between cache keys and tags. The first thing that comes to mind is to self-store this relation in the cache, however APC and Memcached may drop a cache item without further notice, they are caches not persistency layers, so we need to find a persistent store to keep this information. The solution below uses a PDO connection (MySQL, Sqlite, Oracle…) to keep the relation between keys and tags in a table, this table is updated each time there is a cache write (with tags) and when cleaning by tag, so it shouldn&#8217;t hurt much performance if your cache hit is high (the overhead won&#8217;t matter much anyway if you get a lot of misses).</p>

<p>By the way, the code is licensed under the BSD License, so feel free to use it at will as long as you keep the copyright notice in place.</p>

<p><a href='http://svn.pollinimini.net/public/Zend_Cache_Backend_Tags.php'>Download it from my public subversion repository.</a></p>

<p>If we only have a single server we can use a simple Sqlite database. For distributed memcached servers we&#8217;ll need a server based database system like MySql (Note: To improve performance in MySQL it&#8217;s desirable to use the Memory table engine if we don&#8217;t need the cache to survive our MySQL instance).</p>

<p>Following is a simple usage example for the class (Remember to rename the file to the usual ZF directory structure <code>Zend/Cache/Backend/Tags.php</code>).</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>
<span class='c1'>// Setup the cache</span>
<span class='nv'>$frontOpts</span> <span class='o'>=</span> <span class='k'>array</span><span class='p'>(</span>
   <span class='s1'>&#39;lifetime&#39;</span> <span class='o'>=&gt;</span> <span class='mi'>3600</span>
<span class='p'>);</span>
<span class='nv'>$backOpts</span> <span class='o'>=</span> <span class='k'>array</span><span class='p'>(</span>
  <span class='c1'>// Setup the real cache backend</span>
  <span class='s1'>&#39;backend&#39;</span> <span class='o'>=&gt;</span> <span class='k'>array</span><span class='p'>(</span>
    <span class='s1'>&#39;class&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;Zend_Cache_Backend_Apc&#39;</span><span class='p'>,</span>
    <span class='s1'>&#39;options&#39;</span> <span class='o'>=&gt;</span> <span class='k'>array</span><span class='p'>(</span>
    <span class='p'>),</span>
  <span class='p'>),</span>
  <span class='c1'>// Configure the persistent store for the keys-tags mapping</span>
  <span class='s1'>&#39;pdo&#39;</span> <span class='o'>=&gt;</span> <span class='k'>array</span><span class='p'>(</span>
    <span class='s1'>&#39;dsn&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;mysql:host=127.0.0.1;dbname=cachedb&#39;</span><span class='p'>,</span>
    <span class='s1'>&#39;user&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;dbuser&#39;</span><span class='p'>,</span>
    <span class='s1'>&#39;password&#39;</span> <span class='o'>=&gt;</span> <span class='s1'>&#39;dbpass&#39;</span><span class='p'>,</span>
  <span class='p'>),</span>
  <span class='c1'>// Set to true if you want to delete non tagged keys</span>
  <span class='s1'>&#39;track_untagged&#39;</span> <span class='o'>=&gt;</span> <span class='k'>false</span><span class='p'>,</span>
  <span class='c1'>// Set this to true if you don&#39;t want to have duplicates in the table,</span>
  <span class='c1'>// it could improve performace a bit</span>
  <span class='s1'>&#39;duplicates_ok&#39;</span> <span class='o'>=&gt;</span> <span class='k'>false</span>
<span class='p'>);</span>

<span class='c1'>// Create the cache object</span>
<span class='nv'>$cache</span> <span class='o'>=</span> <span class='nx'>Zend_Cache</span><span class='o'>::</span><span class='na'>factory</span><span class='p'>(</span> <span class='s1'>&#39;core&#39;</span><span class='p'>,</span> <span class='s1'>&#39;tags&#39;</span><span class='p'>,</span> <span class='nv'>$frontOps</span><span class='p'>,</span> <span class='nv'>$backOps</span> <span class='p'>);</span>

<span class='c1'>// Store some stuff in the cache</span>
<span class='nv'>$cache</span><span class='o'>-&gt;</span><span class='na'>save</span><span class='p'>(</span> <span class='s1'>&#39;My cached data #1&#39;</span><span class='p'>,</span> <span class='s1'>&#39;cacheA&#39;</span><span class='p'>,</span> <span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;tagA&#39;</span><span class='p'>)</span> <span class='p'>);</span>
<span class='nv'>$cache</span><span class='o'>-&gt;</span><span class='na'>save</span><span class='p'>(</span> <span class='s1'>&#39;My cached data #2&#39;</span><span class='p'>,</span> <span class='s1'>&#39;cacheB&#39;</span><span class='p'>,</span> <span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;tagA&#39;</span><span class='p'>)</span> <span class='p'>);</span>
<span class='nv'>$cache</span><span class='o'>-&gt;</span><span class='na'>save</span><span class='p'>(</span> <span class='s1'>&#39;My cached data #3&#39;</span><span class='p'>,</span> <span class='s1'>&#39;cacheC&#39;</span><span class='p'>,</span> <span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;tagB&#39;</span><span class='p'>)</span> <span class='p'>);</span>

<span class='c1'>// Clean all the keys with tagA</span>
<span class='nv'>$cache</span><span class='o'>-&gt;</span><span class='na'>clean</span><span class='p'>(</span> <span class='nx'>Zend_Cache</span><span class='o'>::</span><span class='na'>CLEANING_MODE_MATCHING_TAG</span><span class='p'>,</span> <span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;tagA&#39;</span><span class='p'>)</span> <span class='p'>);</span>
</code></pre></div>
<h2 id='update_20090307'>Update 2009-03-07</h2>

<p>Jan ‘Mithrandir’ Pedersen has provided in the comments a modification of the class based on Zend_Db_Table instead of PDO. Here is the code:</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>
<span class='sd'>/**</span>
<span class='sd'> * Zend_Cache Tags emulator for backends not supporting them natively</span>
<span class='sd'> *</span>
<span class='sd'> * It&#39;ll use a Zend_Db_Table_Abstract object to persist the mapping</span>
<span class='sd'> * between cache keys and its tags.</span>
<span class='sd'> *</span>
<span class='sd'> * @author ZooCMS Crew</span>
<span class='sd'> * @credits Iván -DrSlump- Montes &lt;drslump AT pollinimini DOT net&gt;</span>
<span class='sd'> * @copyright Copyright (c) 2009 ZooCMS Crew</span>
<span class='sd'> * @copyright Copyright (c) 2008 Iván -DrSlump- Montes &lt;http://pollinimini.net&gt;</span>
<span class='sd'> * @version 1.0</span>
<span class='sd'> * @license BSD</span>
<span class='sd'> */</span>

<span class='k'>class</span> <span class='nc'>Zoo_Cache_Backend_Tags</span> <span class='k'>extends</span> <span class='nx'>Zend_Cache_Backend</span> <span class='k'>implements</span> <span class='nx'>Zend_Cache_Backend_Interface</span>
<span class='p'>{</span>
    <span class='sd'>/**</span>
<span class='sd'>     * Available options</span>
<span class='sd'>     *</span>
<span class='sd'>     * =====&gt; (Zend_Cache_Core) backend:</span>
<span class='sd'>     * A Zend_Cache_Backend object or an associative array declaring its configuration:</span>
<span class='sd'>     * &#39;class&#39; =&gt; (string) The full class name of the backend</span>
<span class='sd'>     * &#39;options&#39; =&gt; (array) The array of options passed to the class constructor</span>
<span class='sd'>     *</span>
<span class='sd'>     * =====&gt; (array) table:</span>
<span class='sd'>     * An associative array with the Zend_Db_Table_Abstract class data:</span>
<span class='sd'>     * &#39;class&#39; =&gt; string) The full class name of the backend</span>
<span class='sd'>     * &#39;options&#39; =&gt; (array) additional configuration parameters to use with Zend_Db_Table_Abstract::__construct()</span>
<span class='sd'>     * It is assumed that the table will have an &#39;cacheid&#39; and a &#39;tag&#39; column</span>
<span class='sd'>     *</span>
<span class='sd'>     * =====&gt; (book) track_untagged:</span>
<span class='sd'>     * If true it will keep track of untagged items so they can be purged by the NOT_MATCHING_TAG mode</span>
<span class='sd'>     *</span>
<span class='sd'>     * =====&gt; (book) duplicates_ok:</span>
<span class='sd'>     * If true it won&#39;t make sure that there are no duplicate entries in the database.</span>
<span class='sd'>     *</span>
<span class='sd'>     * @var array available options</span>
<span class='sd'>     */</span>
    <span class='k'>protected</span> <span class='nv'>$_options</span> <span class='o'>=</span> <span class='k'>array</span><span class='p'>(</span>
        <span class='s1'>&#39;backend&#39;</span> <span class='o'>=&gt;</span> <span class='k'>null</span><span class='p'>,</span>
        <span class='s1'>&#39;table&#39;</span> <span class='o'>=&gt;</span> <span class='k'>null</span><span class='p'>,</span>
        <span class='s1'>&#39;track_untagged&#39;</span><span class='o'>=&gt;</span> <span class='k'>false</span><span class='p'>,</span>
        <span class='s1'>&#39;duplicates_ok&#39;</span> <span class='o'>=&gt;</span> <span class='k'>false</span>
    <span class='p'>);</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Zend_Cache_Core object</span>
<span class='sd'>     *</span>
<span class='sd'>     * @var Zend_Cache_Core object</span>
<span class='sd'>     */</span>
    <span class='k'>private</span> <span class='nv'>$_backend</span> <span class='o'>=</span> <span class='k'>null</span><span class='p'>;</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Table object</span>
<span class='sd'>     *</span>
<span class='sd'>     * @var Zend_Db_Table_Abstract object</span>
<span class='sd'>     */</span>
    <span class='k'>private</span> <span class='nv'>$_table</span> <span class='o'>=</span> <span class='k'>null</span><span class='p'>;</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Constructor</span>
<span class='sd'>     *</span>
<span class='sd'>     * @param array $options associative array of options</span>
<span class='sd'>     * @throws Zend_Cache_Exception</span>
<span class='sd'>     * @return void</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>__construct</span><span class='p'>(</span><span class='nv'>$options</span> <span class='o'>=</span> <span class='k'>array</span><span class='p'>())</span>
    <span class='p'>{</span>
        <span class='k'>parent</span><span class='o'>::</span><span class='na'>__construct</span><span class='p'>(</span><span class='nv'>$options</span><span class='p'>);</span>

        <span class='k'>if</span> <span class='p'>(</span> <span class='nb'>is_array</span><span class='p'>(</span><span class='nv'>$options</span><span class='p'>[</span><span class='s1'>&#39;backend&#39;</span><span class='p'>])</span> <span class='p'>)</span> <span class='p'>{</span>

            <span class='nv'>$backendClass</span> <span class='o'>=</span> <span class='nv'>$options</span><span class='p'>[</span><span class='s1'>&#39;backend&#39;</span><span class='p'>][</span><span class='s1'>&#39;class&#39;</span><span class='p'>];</span>

            <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_backend</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nv'>$backendClass</span><span class='p'>(</span><span class='nv'>$options</span><span class='p'>[</span><span class='s1'>&#39;backend&#39;</span><span class='p'>][</span><span class='s1'>&#39;options&#39;</span><span class='p'>]);</span>

        <span class='p'>}</span> <span class='k'>else</span> <span class='k'>if</span> <span class='p'>(</span> <span class='nv'>$options</span><span class='p'>[</span><span class='s1'>&#39;backend&#39;</span><span class='p'>]</span> <span class='nx'>instanceof</span> <span class='nx'>Zend_Cache_Backend_Interface</span> <span class='p'>)</span> <span class='p'>{</span>

            <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_backend</span> <span class='o'>=</span> <span class='nv'>$options</span><span class='p'>[</span><span class='s1'>&#39;backend&#39;</span><span class='p'>];</span>

        <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
            <span class='nx'>Zend_Cache</span><span class='o'>::</span><span class='na'>throwException</span><span class='p'>(</span><span class='s1'>&#39;The backend option is not correctly set!&#39;</span><span class='p'>);</span>
        <span class='p'>}</span>

        <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='nb'>is_array</span><span class='p'>(</span><span class='nv'>$options</span><span class='p'>[</span><span class='s1'>&#39;table&#39;</span><span class='p'>]))</span> <span class='p'>{</span>
            <span class='nx'>Zend_Cache</span><span class='o'>::</span><span class='na'>throwException</span><span class='p'>(</span><span class='s1'>&#39;The table option is not correctly set!&#39;</span><span class='p'>);</span>
        <span class='p'>}</span>
    <span class='p'>}</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Test if a cache is available for the given id and (if yes) return it (false else)</span>
<span class='sd'>     *</span>
<span class='sd'>     * @param string $id Cache id</span>
<span class='sd'>     * @param boolean $doNotTestCacheValidity If set to true, the cache validity won&#39;t be tested</span>
<span class='sd'>     * @return string|false cached datas</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>load</span><span class='p'>(</span><span class='nv'>$id</span><span class='p'>,</span> <span class='nv'>$doNotTestCacheValidity</span> <span class='o'>=</span> <span class='k'>false</span><span class='p'>)</span>
    <span class='p'>{</span>
        <span class='nv'>$result</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_backend</span><span class='o'>-&gt;</span><span class='na'>load</span><span class='p'>(</span> <span class='nv'>$id</span><span class='p'>,</span> <span class='nv'>$doNotTestCacheValidity</span> <span class='p'>);</span>

        <span class='c1'>// If not in cache make sure to delete the tag mapping to handle cache expiration</span>
        <span class='k'>if</span> <span class='p'>(</span> <span class='nv'>$result</span> <span class='o'>===</span> <span class='k'>false</span> <span class='o'>&amp;&amp;</span> <span class='o'>!</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_options</span><span class='p'>[</span><span class='s1'>&#39;duplicates_ok&#39;</span><span class='p'>]</span> <span class='p'>)</span> <span class='p'>{</span>
            <span class='nv'>$where</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>getAdapter</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>quoteInto</span><span class='p'>(</span><span class='s1'>&#39;cacheid = ?&#39;</span><span class='p'>,</span> <span class='nv'>$id</span><span class='p'>);</span>
            <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>delete</span><span class='p'>(</span><span class='nv'>$where</span><span class='p'>);</span>
        <span class='p'>}</span>

        <span class='k'>return</span> <span class='nv'>$result</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Get Zend_Db_Table_Abstract object for persistence</span>
<span class='sd'>     */</span>
    <span class='k'>protected</span> <span class='k'>function</span> <span class='nf'>getTable</span><span class='p'>()</span> <span class='p'>{</span>
        <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_table</span><span class='p'>)</span> <span class='p'>{</span>
            <span class='nv'>$tableClass</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_options</span><span class='p'>[</span><span class='s1'>&#39;table&#39;</span><span class='p'>][</span><span class='s1'>&#39;class&#39;</span><span class='p'>];</span>
            <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_table</span> <span class='o'>=</span> <span class='k'>new</span> <span class='nv'>$tableClass</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_options</span><span class='p'>[</span><span class='s1'>&#39;table&#39;</span><span class='p'>][</span><span class='s1'>&#39;options&#39;</span><span class='p'>]);</span>
        <span class='p'>}</span>
        <span class='k'>return</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_table</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Test if a cache is available or not (for the given id)</span>
<span class='sd'>     *</span>
<span class='sd'>     * @param string $id Cache id</span>
<span class='sd'>     * @return mixed|false (a cache is not available) or &quot;last modified&quot; timestamp (int) of the available cache record</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>test</span><span class='p'>(</span><span class='nv'>$id</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='k'>return</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_backend</span><span class='o'>-&gt;</span><span class='na'>test</span><span class='p'>(</span><span class='nv'>$id</span><span class='p'>);</span>
    <span class='p'>}</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Save some string datas into a cache record</span>
<span class='sd'>     *</span>
<span class='sd'>     * Note : $data is always &quot;string&quot; (serialization is done by the</span>
<span class='sd'>     * core not by the backend)</span>
<span class='sd'>     *</span>
<span class='sd'>     * @param string $data Datas to cache</span>
<span class='sd'>     * @param string $id Cache id</span>
<span class='sd'>     * @param array $tags Array of strings, the cache record will be tagged by each string entry</span>
<span class='sd'>     * @param int $specificLifetime If != false, set a specific lifetime for this cache record (null =&gt; infinite lifetime)</span>
<span class='sd'>     * @return boolean True if no problem</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>save</span><span class='p'>(</span><span class='nv'>$data</span><span class='p'>,</span> <span class='nv'>$id</span><span class='p'>,</span> <span class='nv'>$tags</span> <span class='o'>=</span> <span class='k'>array</span><span class='p'>(),</span> <span class='nv'>$specificLifetime</span> <span class='o'>=</span> <span class='k'>false</span><span class='p'>)</span>
    <span class='p'>{</span>
        <span class='nv'>$result</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_backend</span><span class='o'>-&gt;</span><span class='na'>save</span><span class='p'>(</span> <span class='nv'>$data</span><span class='p'>,</span> <span class='nv'>$id</span><span class='p'>,</span> <span class='k'>array</span><span class='p'>(),</span> <span class='nv'>$specificLifetime</span> <span class='p'>);</span>

        <span class='k'>if</span> <span class='p'>(</span> <span class='nv'>$result</span> <span class='p'>)</span> <span class='p'>{</span>
            <span class='c1'>// Makes sure to always store the key for notMatchingTag cleaning mode</span>
            <span class='k'>if</span> <span class='p'>(</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_options</span><span class='p'>[</span><span class='s1'>&#39;track_untagged&#39;</span><span class='p'>]</span> <span class='o'>&amp;&amp;</span> <span class='o'>!</span><span class='nb'>count</span><span class='p'>(</span><span class='nv'>$tags</span><span class='p'>)</span> <span class='p'>)</span> <span class='p'>{</span>
                <span class='nv'>$tags</span> <span class='o'>=</span> <span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;&#39;</span><span class='p'>);</span>
            <span class='p'>}</span>

            <span class='k'>if</span> <span class='p'>(</span> <span class='nb'>count</span><span class='p'>(</span><span class='nv'>$tags</span><span class='p'>)</span> <span class='p'>)</span> <span class='p'>{</span>
                <span class='k'>foreach</span> <span class='p'>(</span> <span class='nv'>$tags</span> <span class='k'>as</span> <span class='nv'>$tag</span> <span class='p'>)</span> <span class='p'>{</span>
                    <span class='nv'>$result</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>fetchAll</span><span class='p'>(</span>
                                <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>select</span><span class='p'>()</span>
                                    <span class='o'>-&gt;</span><span class='na'>where</span><span class='p'>(</span><span class='s1'>&#39;cacheid = ?&#39;</span><span class='p'>,</span> <span class='nv'>$id</span><span class='p'>)</span>
                                    <span class='o'>-&gt;</span><span class='na'>where</span><span class='p'>(</span><span class='s1'>&#39;tag = ?&#39;</span><span class='p'>,</span> <span class='nv'>$tag</span><span class='p'>)</span>
                    <span class='p'>);</span>

                    <span class='k'>if</span> <span class='p'>(</span><span class='o'>!</span><span class='nv'>$result</span><span class='o'>-&gt;</span><span class='na'>count</span><span class='p'>())</span> <span class='p'>{</span>
                        <span class='nv'>$row</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>createRow</span><span class='p'>(</span><span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;cacheid&#39;</span> <span class='o'>=&gt;</span> <span class='nv'>$id</span><span class='p'>,</span> <span class='s1'>&#39;tag&#39;</span> <span class='o'>=&gt;</span> <span class='nv'>$tag</span><span class='p'>));</span>
                        <span class='nv'>$row</span><span class='o'>-&gt;</span><span class='na'>save</span><span class='p'>();</span>
                    <span class='p'>}</span>
                <span class='p'>}</span>
            <span class='p'>}</span>
        <span class='p'>}</span>

        <span class='k'>return</span> <span class='nv'>$result</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Remove a cache record</span>
<span class='sd'>     *</span>
<span class='sd'>     * @param string $id Cache id</span>
<span class='sd'>     * @return boolean True if no problem</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>remove</span><span class='p'>(</span><span class='nv'>$id</span><span class='p'>)</span>
    <span class='p'>{</span>
        <span class='k'>if</span> <span class='p'>(</span> <span class='o'>!</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_options</span><span class='p'>[</span><span class='s1'>&#39;duplicates_ok&#39;</span><span class='p'>]</span> <span class='p'>)</span> <span class='p'>{</span>
            <span class='nv'>$where</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>getAdapter</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>quoteInto</span><span class='p'>(</span><span class='s1'>&#39;cacheid = ?&#39;</span><span class='p'>,</span> <span class='nv'>$id</span><span class='p'>);</span>
            <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>delete</span><span class='p'>(</span><span class='nv'>$where</span><span class='p'>);</span>
        <span class='p'>}</span>

        <span class='k'>return</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_backend</span><span class='o'>-&gt;</span><span class='na'>remove</span><span class='p'>(</span><span class='nv'>$id</span><span class='p'>);</span>
    <span class='p'>}</span>

    <span class='sd'>/**</span>
<span class='sd'>     * Clean some cache records</span>
<span class='sd'>     *</span>
<span class='sd'>     * Available modes are :</span>
<span class='sd'>     * &#39;all&#39; (default) =&gt; remove all cache entries ($tags is not used)</span>
<span class='sd'>     * &#39;old&#39; =&gt; remove too old cache entries ($tags is not used)</span>
<span class='sd'>     * &#39;matchingTag&#39; =&gt; remove cache entries matching all given tags</span>
<span class='sd'>     * ($tags can be an array of strings or a single string)</span>
<span class='sd'>     * &#39;notMatchingTag&#39; =&gt; remove cache entries not matching one of the given tags</span>
<span class='sd'>     * ($tags can be an array of strings or a single string)</span>
<span class='sd'>     *</span>
<span class='sd'>     * @param string $mode Clean mode</span>
<span class='sd'>     * @param array $tags Array of tags</span>
<span class='sd'>     * @return boolean True if no problem</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>clean</span><span class='p'>(</span><span class='nv'>$mode</span> <span class='o'>=</span> <span class='nx'>Zend_Cache</span><span class='o'>::</span><span class='na'>CLEANING_MODE_ALL</span><span class='p'>,</span> <span class='nv'>$tags</span> <span class='o'>=</span> <span class='k'>array</span><span class='p'>())</span>
    <span class='p'>{</span>
        <span class='k'>if</span> <span class='p'>(</span> <span class='nv'>$mode</span> <span class='o'>==</span> <span class='nx'>Zend_Cache</span><span class='o'>::</span><span class='na'>CLEANING_MODE_MATCHING_TAG</span> <span class='o'>||</span>
             <span class='nv'>$mode</span> <span class='o'>==</span> <span class='nx'>Zend_Cache</span><span class='o'>::</span><span class='na'>CLEANING_MODE_NOT_MATCHING_TAG</span> <span class='p'>)</span> <span class='p'>{</span>

            <span class='k'>if</span> <span class='p'>(</span> <span class='o'>!</span><span class='nb'>is_array</span><span class='p'>(</span><span class='nv'>$tags</span><span class='p'>)</span> <span class='p'>)</span> <span class='p'>{</span>
                <span class='nv'>$tags</span> <span class='o'>=</span> <span class='k'>array</span><span class='p'>(</span><span class='nv'>$tags</span><span class='p'>);</span>
            <span class='p'>}</span>

            <span class='c1'>// Quote the tags and convert to a string</span>
            <span class='nv'>$tags</span> <span class='o'>=</span> <span class='nb'>array_map</span><span class='p'>(</span><span class='k'>array</span><span class='p'>(</span><span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>getAdapter</span><span class='p'>(),</span> <span class='s1'>&#39;quote&#39;</span><span class='p'>),</span> <span class='nv'>$tags</span><span class='p'>);</span>

            <span class='c1'>// Build the query for the desired matching mode</span>
            <span class='k'>if</span> <span class='p'>(</span> <span class='nv'>$mode</span> <span class='o'>==</span> <span class='nx'>Zend_Cache</span><span class='o'>::</span><span class='na'>CLEANING_MODE_MATCHING_TAG</span> <span class='p'>)</span> <span class='p'>{</span>
                <span class='nv'>$items</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>select</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>where</span><span class='p'>(</span><span class='s1'>&#39;tag IN (?)&#39;</span><span class='p'>,</span> <span class='nv'>$tags</span><span class='p'>);</span>
            <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
                <span class='nv'>$items</span> <span class='o'>=</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>getTable</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>select</span><span class='p'>()</span><span class='o'>-&gt;</span><span class='na'>where</span><span class='p'>(</span><span class='s1'>&#39;tag NOT IN (?)&#39;</span><span class='p'>,</span> <span class='nv'>$tags</span><span class='p'>);</span>
            <span class='p'>}</span>

            <span class='k'>foreach</span> <span class='p'>(</span> <span class='nv'>$items</span> <span class='k'>as</span> <span class='nv'>$item</span> <span class='p'>)</span> <span class='p'>{</span>
                <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>remove</span><span class='p'>(</span> <span class='nv'>$item</span><span class='o'>-&gt;</span><span class='na'>cacheid</span> <span class='p'>);</span>
            <span class='p'>}</span>

            <span class='k'>return</span> <span class='k'>true</span><span class='p'>;</span>

        <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>

            <span class='k'>return</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_backend</span><span class='o'>-&gt;</span><span class='na'>clean</span><span class='p'>(</span><span class='nv'>$mode</span><span class='p'>,</span> <span class='nv'>$tags</span><span class='p'>);</span>

        <span class='p'>}</span>
    <span class='p'>}</span>


    <span class='sd'>/**</span>
<span class='sd'>     * Magic call handler to forward to the real backend the method calls</span>
<span class='sd'>     *</span>
<span class='sd'>     * @param string $method The method called</span>
<span class='sd'>     * @param array $args The arguments used packed as an array</span>
<span class='sd'>     * @return mixed</span>
<span class='sd'>     */</span>
    <span class='k'>public</span> <span class='k'>function</span> <span class='nf'>__call</span><span class='p'>(</span> <span class='nv'>$method</span><span class='p'>,</span> <span class='nv'>$args</span> <span class='p'>)</span>
    <span class='p'>{</span>
        <span class='k'>return</span> <span class='nb'>call_user_method_array</span><span class='p'>(</span> <span class='nv'>$method</span><span class='p'>,</span> <span class='nv'>$this</span><span class='o'>-&gt;</span><span class='na'>_backend</span><span class='p'>,</span> <span class='nv'>$args</span> <span class='p'>);</span>
    <span class='p'>}</span>
<span class='p'>}</span>
</code></pre></div>
    
  </div>
   
  <div class="entry-footer">
  </div>
</div>
 

  <div class="entry">
  <h2>
    
    <a href="/blog/really-simple-include-filter-drupal">A really simple include filter for Drupal</a>
    
  </h2>
   
  <div class="entry-meta">
    Aug 06, 2008
    — Filled in Code
    
      and tagged as
      webdev, php, and drupal
    

    <a class="entry-comments" href="/blog/really-simple-include-filter-drupal/#disqus_thread"></a>
  </div>
   
  <div class="entry-content">
    
        <p>I&#8217;ve been using <a href='http://texy.info/en/'>Texy!</a> lately to write in my Drupal powered blog, it&#8217;s a great Markdown/Textile replacement and it even has a syntax highlighting addon which helps a lot to publish source code in the posts.</p>

<p>I&#8217;ve found however a problem. I usually keep my source files in my subversion repository and sometimes I want to show the syntax highlighted code of one of those files in the post. I was getting tired to copy-pasting the contents so I&#8217;ve implemented a dead simple Drupal input filter which dynamically includes a local or remote file as simple text in the content. I guess it can be useful too without Texy!</p>

<p>The syntax is very easy to use and remember:</p>

<pre><code>{include http://myserver.com/myfile.ext}</code></pre>

<p>The module will use the Curl extension if available to fetch remote files, so it can work on hosts like DreamHost, which don&#8217;t allow URLs via nomal file functions.</p>

<p>Here is the .info</p>

<pre><code>name = Include Filter
description = This module allows to include a text file in a node.
package = Filters
version = 1.0
core = 6.xCopy to clipboard</code></pre>

<p>And the .module</p>
<div class='highlight'><pre><code class='php'><span class='cp'>&lt;?php</span>

<span class='k'>function</span> <span class='nf'>includefilter_filter</span><span class='p'>(</span><span class='nv'>$op</span><span class='p'>,</span> <span class='nv'>$delta</span> <span class='o'>=</span> <span class='mi'>0</span><span class='p'>,</span> <span class='nv'>$format</span> <span class='o'>=</span> <span class='o'>-</span><span class='mi'>1</span><span class='p'>,</span> <span class='nv'>$text</span> <span class='o'>=</span> <span class='s1'>&#39;&#39;</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='k'>switch</span> <span class='p'>(</span><span class='nv'>$op</span><span class='p'>)</span> <span class='p'>{</span>
        <span class='k'>case</span> <span class='s1'>&#39;list&#39;</span><span class='o'>:</span>
            <span class='k'>return</span> <span class='k'>array</span><span class='p'>(</span><span class='s1'>&#39;Include filter&#39;</span><span class='p'>);</span>

        <span class='k'>case</span> <span class='s1'>&#39;description&#39;</span><span class='o'>:</span>
            <span class='k'>return</span> <span class='nx'>t</span><span class='p'>(</span><span class='s1'>&#39;Allows to include a text file in the content. Give it a negative weight so it\&#39;s processed before all other filters&#39;</span><span class='p'>);</span>

        <span class='k'>case</span> <span class='s1'>&#39;prepare&#39;</span><span class='o'>:</span>
        <span class='k'>case</span> <span class='s1'>&#39;process&#39;</span><span class='o'>:</span>
            <span class='nv'>$text</span> <span class='o'>=</span> <span class='nb'>preg_replace_callback</span><span class='p'>(</span><span class='s1'>&#39;!{include\s+([^}]+)}!&#39;</span><span class='p'>,</span> <span class='s1'>&#39;_includefilter_replace&#39;</span><span class='p'>,</span> <span class='nv'>$text</span><span class='p'>);</span>
            <span class='k'>return</span> <span class='nv'>$text</span><span class='p'>;</span>

        <span class='k'>case</span> <span class='s1'>&#39;no cache&#39;</span><span class='o'>:</span>
            <span class='k'>return</span> <span class='k'>false</span><span class='p'>;</span>
        <span class='k'>default</span><span class='o'>:</span>
            <span class='k'>return</span> <span class='nv'>$text</span><span class='p'>;</span>
    <span class='p'>}</span>
<span class='p'>}</span>

<span class='k'>function</span> <span class='nf'>_includefilter_replace</span><span class='p'>(</span><span class='nv'>$m</span><span class='p'>)</span> <span class='p'>{</span>
    <span class='k'>if</span> <span class='p'>(</span> <span class='nb'>preg_match</span><span class='p'>(</span><span class='s1'>&#39;!^https?://!i&#39;</span><span class='p'>,</span> <span class='nv'>$m</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>])</span> <span class='o'>&amp;&amp;</span> <span class='nb'>function_exists</span><span class='p'>(</span><span class='s1'>&#39;curl_init&#39;</span><span class='p'>)</span> <span class='p'>)</span> <span class='p'>{</span>
        <span class='nv'>$ch</span> <span class='o'>=</span> <span class='nb'>curl_init</span><span class='p'>();</span>
        <span class='nb'>curl_setopt</span><span class='p'>(</span><span class='nv'>$ch</span><span class='p'>,</span> <span class='nx'>CURLOPT_URL</span><span class='p'>,</span> <span class='nv'>$m</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>]);</span>
        <span class='nb'>curl_setopt</span><span class='p'>(</span><span class='nv'>$ch</span><span class='p'>,</span> <span class='nx'>CURLOPT_RETURNTRANSFER</span><span class='p'>,</span> <span class='mi'>1</span><span class='p'>);</span>
        <span class='nb'>curl_setopt</span><span class='p'>(</span><span class='nv'>$ch</span><span class='p'>,</span> <span class='nx'>CURLOPT_CONNECTTIMEOUT</span><span class='p'>,</span> <span class='mi'>10</span><span class='p'>);</span>
        <span class='nv'>$txt</span> <span class='o'>=</span> <span class='nb'>curl_exec</span><span class='p'>(</span><span class='nv'>$ch</span><span class='p'>);</span>
        <span class='nb'>curl_close</span><span class='p'>(</span><span class='nv'>$ch</span><span class='p'>);</span>
    <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
        <span class='nv'>$txt</span> <span class='o'>=</span> <span class='o'>@</span><span class='nb'>file_get_contents</span><span class='p'>(</span><span class='nv'>$m</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>]);</span>
    <span class='p'>}</span>

    <span class='k'>if</span> <span class='p'>(</span> <span class='nv'>$txt</span> <span class='o'>===</span> <span class='k'>false</span> <span class='p'>)</span> <span class='p'>{</span>
        <span class='k'>return</span> <span class='s1'>&#39;*IncludeFilter: Error including &quot;&#39;</span> <span class='o'>.</span> <span class='nv'>$m</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>]</span> <span class='o'>.</span> <span class='s1'>&#39;&quot;*&#39;</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='k'>return</span> <span class='nv'>$txt</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre></div>
<blockquote>
<p>Note: Remember to give this filter a negative weight so it gets executed before any other filter in your input format.</p>
</blockquote>
    
  </div>
   
  <div class="entry-footer">
  </div>
</div>
 




  <div id="pagination">
    
      <a class="prev" href="/page3/">&laquo; Newer</a>
    
  
    
      
        <a class="num" href="/">1</a>
      
    
      
        <a class="num" href="/page2/">2</a>
      
    
      
        <a class="num" href="/page3/">3</a>
      
    
      
        <span class="num">4</span>
      
    
      
        <a class="num" href="/page5/">5</a>
      
    
      
        <a class="num" href="/page6/">6</a>
      
    
      
        <a class="num" href="/page7/">7</a>
      
    
      
        <a class="num" href="/page8/">8</a>
      
    
      
        <a class="num" href="/page9/">9</a>
      
    
      
        <a class="num" href="/page10/">10</a>
      
    
      
        <a class="num" href="/page11/">11</a>
      
    
      
        <a class="num" href="/page12/">12</a>
      
    
  
    
      <a class="next" href="/page5/">Older &raquo;</a>
    
  </div>



      </div>       
    </div>
     
    <div id="footer">
      <div id="about">
        
        <p>Content is licensed under <a href="http://creativecommons.org/licenses/by/2.5/">Creative Commons Attribution 2.5</a> unless stated otherwise.
</p>
        
        <p>The opinions of authors expressed herein are those of the author and do not necessarily state or reflect those of the site owner.
</p>
        
      </div>
      <div id="copyright">
        
        <p>&copy; Copyright 2004-2010 Iván -DrSlump- Montes</p>
        
        <p>Design based on <a href="http://dezinerfolio.com/demo/darkelegance">Dark Elegance</a> by <a href="http://dezinerfolio.com">Dezinerfolio</a>
</p>
        
        <p>Published with <a href="http://jekyllrb.com">Jekyll</a></p>
        
      </div>
    </div>
     
    
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.1/jquery.min.js" type="text/javascript" charset="utf-8"></script>
    
     
    

    <!-- Disqus number of comments -->
    <script type="text/javascript" defer="defer">
      (function(){
        var links = document.getElementsByTagName('a');
        var query = '?';
        for (var i=0; i<links.length; i++){
          if (links[i].href.indexOf('#disqus_thread') >= 0){
            query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
          }
        }
        document.write('<script defer="defer" charset="utf-8" type="text/javascript" src="http://disqus.com/forums/pollinimini/get_num_replies.js' + query + '"></' + 'script>');
      })();
    </script>

    <!-- Google Analytics -->
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
      var pageTracker = _gat._getTracker("UA-580032-2");
      pageTracker._trackPageview();
    } catch(err) {}
    </script>
    
  </body>
</html>
